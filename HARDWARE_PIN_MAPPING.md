# 🔌 하드웨어 핀 매핑 가이드

## 📋 전체 핀 구성표

| 부품 | GPIO 번호 | PIN 번호 | 설명 | 연결 상태 |
|------|-----------|----------|------|-----------|
| **서보모터 1개 (밥주기용)** | GPIO 18 | PIN 12 | PWM 출력 (hardware PWM) | ✅ 연결됨 |
| **서보모터 2개 (레이저용 X/Y축)** | GPIO 19, 13 | PIN 35, 33 | PWM 출력 (레이저 방향 제어) | ✅ 연결됨 |
| **모터 드라이버 (SMG-A)** | GPIO 23, 24 | PIN 16, 18 | IN1, IN2 (모터 A 방향 제어) | ✅ 연결됨 |
| | GPIO 27, 22 | PIN 13, 15 | IN3, IN4 (모터 B 방향 제어) | ✅ 연결됨 |
| | GPIO 12, 26 | PIN 32, 37 | ENA, ENB (PWM 속도 제어용) | ✅ 연결됨 |
| **레이저 포인터** | GPIO 17 | PIN 11 | 단순 ON/OFF | ✅ 연결됨 |
| **릴레이 (공 발사용)** | GPIO 5 | PIN 29 | 릴레이 제어 | ✅ 연결됨 |
| **5V 전원** | - | PIN 2, 4 | 5V | ✅ 연결됨 |
| **GND** | - | PIN 6, 9, 14, ... | GND | ✅ 연결됨 |

## 🔧 소프트웨어 핀 설정

### 1. 모터 드라이버 (DC 모터 2개)
```python
# services/motor_service.py
ENA, INT1, INT2 = 12, 23, 24  # 우측 모터 (ENA=PIN32, IN1=PIN16, IN2=PIN18)
ENB, INT3, INT4 = 26, 27, 22  # 좌측 모터 (ENB=PIN37, IN3=PIN13, IN4=PIN15)
```

### 2. 급식용 서보모터
```python
# services/feed_service.py
SERVO_PIN = 18  # 급식용 서보모터 (PIN 12, hardware PWM)
```

### 3. 레이저용 서보모터 (X/Y축)
```python
# services/xy_servo.py
X_SERVO_PIN = 19  # X축 서보모터 (좌우, PIN 35)
Y_SERVO_PIN = 13  # Y축 서보모터 (상하, PIN 33)
```

### 4. 레이저 포인터
```python
# services/laser_service.py
LASER_PIN = 17  # 레이저 포인터 (PIN 11)
```

### 5. 릴레이 (공 발사용)
```python
# services/sol_service.py
RELAY_PIN = 5  # 릴레이 (공 발사용, PIN 29)
```

## 🎯 기능별 핀 사용

### 🚗 주행 제어
- **전진/후진**: 모터 A, B 동시 제어
- **좌회전**: 모터 A 전진, 모터 B 후진
- **우회전**: 모터 A 후진, 모터 B 전진
- **정지**: 모든 모터 정지

### 🍽️ 급식 시스템
- **서보모터**: GPIO 18 (PIN 12)
- **동작**: 0도 → 90도 → 0도 (사료 배출)

### 🎯 레이저 놀이
- **X축 서보**: GPIO 19 (PIN 35) - 좌우 방향
- **Y축 서보**: GPIO 13 (PIN 33) - 상하 방향
- **레이저**: GPIO 17 (PIN 11) - ON/OFF

### 🔥 공 발사
- **릴레이**: GPIO 5 (PIN 29)
- **동작**: 릴레이 ON → 일정 시간 → OFF

## ⚡ 전원 공급

### 5V 전원
- **PIN 2, 4**: 5V 전원
- **사용 부품**: 서보모터 3개, 레이저, 릴레이

### 접지 (GND)
- **PIN 6, 9, 14, 20, 25, 30, 34, 39**: GND
- **모든 부품의 GND 연결**

## 🔍 핀 점검 방법

### 1. GPIO 상태 확인
```bash
# GPIO 상태 확인
gpio readall

# 특정 핀 상태 확인
gpio read 17  # 레이저 핀
gpio read 18  # 급식 서보
gpio read 19  # X축 서보
gpio read 13  # Y축 서보
```

### 2. PWM 출력 확인
```bash
# PWM 활성화 확인
ls /sys/class/pwm/

# PWM 설정 확인
cat /sys/class/pwm/pwmchip0/pwm0/period
cat /sys/class/pwm/pwmchip0/pwm0/duty_cycle
```

### 3. 소프트웨어 테스트
```bash
# 개별 서비스 테스트
python test_xy_servo.py
python test_motor.py
python test_laser.py
```

## ⚠️ 주의사항

### 1. 전원 관리
- **서보모터**: 충분한 전류 공급 필요 (각각 500mA 이상)
- **모터**: 모터 드라이버를 통한 안전한 제어
- **릴레이**: 5V 릴레이 모듈 사용

### 2. 핀 충돌 방지
- **PWM 핀**: GPIO 12, 13, 18, 19 사용
- **일반 GPIO**: 나머지 핀들
- **중복 사용 금지**: 하나의 핀에 여러 부품 연결 금지

### 3. 안전성
- **초기화 순서**: GPIO 설정 → PWM 설정 → 부품 제어
- **정리 순서**: 부품 정지 → PWM 정지 → GPIO 정리
- **비상 정지**: 모든 출력을 안전한 상태로

## 🔧 문제 해결

### 서보모터가 움직이지 않는 경우
1. **전원 확인**: 5V 전원 공급 상태
2. **핀 연결**: GPIO 핀 연결 상태
3. **PWM 설정**: PWM 주파수 및 듀티사이클
4. **소프트웨어**: 초기화 함수 호출 확인

### 모터가 제대로 동작하지 않는 경우
1. **모터 드라이버**: SMG-A 모듈 상태
2. **핀 연결**: IN1~IN4, ENA, ENB 연결
3. **전원**: 모터 전원 공급 상태
4. **PWM**: 속도 제어 PWM 신호

### 레이저가 켜지지 않는 경우
1. **전원**: 레이저 모듈 전원 공급
2. **핀 연결**: GPIO 17 연결 상태
3. **소프트웨어**: laser_on() 함수 호출 확인

## 📝 업데이트 내역

### v2.0 (현재)
- 하드웨어 구성표에 맞는 핀 번호 수정
- 모든 서비스 파일의 핀 번호 통일
- 상세한 핀 매핑 문서 작성

### v1.0 (이전)
- 기본적인 핀 설정
- 개별 서비스별 핀 정의 